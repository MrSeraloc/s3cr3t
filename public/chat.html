<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="pageTitle">Confessorium</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap');
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #0a0a0a; --surface: #1a1a1a; --surface-raised: #252525;
            --text: #ffffff; --text-secondary: #a0a0a0; --text-muted: #666;
            --border: rgba(255,255,255,0.1); --border-strong: rgba(255,255,255,0.15);
            --msg-other: #1a1a1a; --msg-mine: #1a1a1a; --msg-mine-text: #ffffff;
            --accent: #00ff41; --accent-dark: #00cc33; --accent-subtle: rgba(0,255,65,0.1);
            --green: #00ff41; --red: #ff4444;
        }
        body.light-theme {
            --bg: #f8f8f8; --surface: #ffffff; --surface-raised: #f0f0f0;
            --text: #0a0a0a; --text-secondary: #555; --text-muted: #999;
            --border: rgba(0,0,0,0.1); --border-strong: rgba(0,0,0,0.15);
            --msg-other: #f0f0f0; --msg-mine: #f0f0f0; --msg-mine-text: #0a0a0a;
            --accent: #00cc33; --accent-dark: #009922; --accent-subtle: rgba(0,204,51,0.1);
            --green: #00cc33; --red: #cc0000;
        }
        body { font-family:'Space Grotesk',-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; background:var(--bg); color:var(--text); display:flex; justify-content:center; align-items:center; height:100vh; transition:background-color .3s,color .3s; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; position:relative; overflow:hidden; }

        /* Matrix background canvas */
        #matrix-canvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; }

        #main-layout { position:relative; z-index:1; display:flex; width:100%; height:100%; max-width:1000px; max-height:96vh; padding:16px; gap:16px; }
        #app-container { flex-grow:1; min-height:0; display:flex; flex-direction:column; background:var(--surface); border-radius:20px; border:1px solid var(--border); overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,0.3); }

        /* Banner */
        #banner { display:none; }

        /* Header */
        #header { padding:14px 20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border); flex-shrink:0; gap:12px; background:rgba(0,0,0,0.3); }
        .header-group { display:flex; align-items:center; gap:8px; }
        .icon-btn { background:transparent; border:1px solid var(--border); color:var(--text); width:36px; height:36px; border-radius:12px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all .2s; }
        .icon-btn:hover { background:var(--accent-subtle); border-color:var(--accent); color:var(--accent); }
        .icon-btn svg { width:18px; height:18px; stroke:currentColor; stroke-width:2; }

        /* E2E Badge */
        #e2e-badge { display:flex; align-items:center; gap:6px; padding:6px 12px; background:rgba(0,255,65,0.1); border:1px solid rgba(0,255,65,0.2); border-radius:10px; cursor:pointer; transition:all .2s; font-size:.75rem; font-weight:600; color:var(--green); text-transform:uppercase; letter-spacing:0.5px; }
        #e2e-badge:hover { background:rgba(0,255,65,0.15); border-color:var(--green); }
        #e2e-badge svg { width:14px; height:14px; stroke:var(--green); fill:none; }

        /* Username display */
        #my-username-wrapper { display:flex; align-items:center; gap:6px; padding:6px 12px; background:var(--accent-subtle); border:1px solid rgba(0,255,65,0.2); border-radius:10px; cursor:pointer; transition:all .2s; font-size:.8rem; font-weight:600; color:var(--accent); max-width:180px; }
        #my-username-wrapper:hover { background:rgba(0,255,65,0.15); border-color:var(--accent); }
        #my-username-wrapper svg { width:14px; height:14px; stroke:var(--accent); fill:none; flex-shrink:0; }
        #my-username-text { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        #my-username-input { display:none; width:120px; padding:6px 10px; border:1px solid var(--accent); background:var(--surface-raised); color:var(--text); border-radius:8px; font-family:'Space Grotesk',sans-serif; font-size:.8rem; font-weight:600; outline:none; }
        #my-username-wrapper.editing #my-username-text,
        #my-username-wrapper.editing svg { display:none; }
        #my-username-wrapper.editing #my-username-input { display:block; }

        /* Online users */
        #online-users-wrapper { position:relative; }
        #online-users-btn { display:flex; align-items:center; gap:8px; background:transparent; border:1px solid var(--border); border-radius:10px; padding:6px 12px; cursor:pointer; transition:all .2s; }
        #online-users-btn:hover { background:var(--accent-subtle); border-color:var(--accent); }
        #online-users-btn svg { width:16px; height:16px; stroke:var(--text-secondary); flex-shrink:0; transition:stroke .2s; }
        #online-users-btn:hover svg { stroke:var(--accent); }
        .online-dot { width:8px; height:8px; border-radius:50%; background:var(--green); flex-shrink:0; box-shadow:0 0 8px var(--green); }
        #online-users-btn .online-count { font-size:.8rem; font-weight:600; color:var(--text); }
        #online-users-btn .online-label { font-size:.75rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.3px; }
        .chevron-icon { width:14px!important; height:14px!important; stroke:var(--text-muted)!important; transition:transform .2s; }
        #online-users-wrapper.open .chevron-icon { transform:rotate(180deg); }
        #online-users-dropdown { position:absolute; top:calc(100% + 8px); left:0; min-width:240px; background:var(--surface); border:1px solid var(--border-strong); border-radius:14px; padding:10px; z-index:2000; box-shadow:0 20px 40px rgba(0,0,0,0.4); opacity:0; transform:translateY(-4px); pointer-events:none; transition:opacity .2s,transform .2s; }
        #online-users-wrapper.open #online-users-dropdown { opacity:1; transform:translateY(0); pointer-events:auto; }
        .dropdown-header { display:flex; align-items:center; justify-content:space-between; padding:8px 12px 10px; border-bottom:1px solid var(--border); margin-bottom:8px; }
        .dropdown-header span { font-size:.75rem; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; color:var(--text-muted); }
        .dropdown-header .count-badge { font-size:.75rem; font-weight:600; background:rgba(0,255,65,0.1); color:var(--accent); padding:3px 10px; border-radius:20px; border:1px solid rgba(0,255,65,0.2); }
        #online-users-list { list-style:none; max-height:250px; overflow-y:auto; scrollbar-width:thin; scrollbar-color:var(--border-strong) transparent; }
        .online-user-item { display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:10px; transition:all .15s; }
        .online-user-item:hover { background:var(--accent-subtle); }
        .user-avatar { width:32px; height:32px; border-radius:10px; background:var(--surface-raised); border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:.75rem; font-weight:700; color:var(--accent); flex-shrink:0; }
        .user-info { display:flex; flex-direction:column; min-width:0; }
        .user-info .user-name { font-size:.85rem; font-weight:600; color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .user-info .user-status { display:flex; align-items:center; gap:4px; font-size:.7rem; color:var(--green); font-weight:600; text-transform:uppercase; letter-spacing:0.3px; }
        .user-info .user-status .status-dot { width:6px; height:6px; border-radius:50%; background:var(--green); box-shadow:0 0 6px var(--green); }

        /* Sound/Notification toggles */
        .toggle-btn { position:relative; }
        .toggle-btn.off svg { opacity:.4; }
        .toggle-btn.off::after { content:''; position:absolute; top:50%; left:50%; width:20px; height:2px; background:var(--text-secondary); transform:translate(-50%,-50%) rotate(-45deg); border-radius:1px; }

        /* Theme switcher wrapper */
        #theme-switcher { display:flex; gap:10px; align-items:center; padding:6px 10px; background:rgba(0,0,0,0.2); border-radius:12px; border:1px solid var(--border); }
        .theme-icons { display:flex; gap:8px; align-items:center; }
        .theme-icon { width:18px; height:18px; color:var(--text-secondary); transition:all .2s; cursor:pointer; font-size:16px; }
        .theme-icon.active { color:var(--accent); transform:scale(1.15); }

        /* Toggle switch */
        .toggle-switch { position:relative; width:52px; height:26px; background:rgba(0,0,0,0.2); border:1px solid var(--border); border-radius:13px; cursor:pointer; transition:all .3s; }
        .toggle-switch.active { background:rgba(0,255,65,.15); border-color:rgba(0,255,65,.3); }
        .toggle-knob { position:absolute; width:22px; height:22px; background:var(--text-secondary); border-radius:11px; left:2px; top:2px; transition:left .3s,background .3s; }
        .toggle-switch.active .toggle-knob { left:28px; background:var(--accent); }

        /* Chat area */
        #chat-container { flex-grow:1; display:flex; flex-direction:column; overflow:hidden; position:relative; background:rgba(0,0,0,0.2); }
        #messages { list-style-type:none; padding:20px; overflow-y:auto; flex-grow:1; display:flex; flex-direction:column; gap:4px; scrollbar-width:thin; scrollbar-color:var(--border-strong) transparent; }
        #messages::-webkit-scrollbar { width:6px; }
        #messages::-webkit-scrollbar-track { background:transparent; }
        #messages::-webkit-scrollbar-thumb { background:var(--border-strong); border-radius:3px; }
        #messages li { padding:12px 14px; border-radius:14px; max-width:70%; word-wrap:break-word; line-height:1.5; font-size:.95rem; position:relative; font-weight:400; }
        #messages li.grouped { padding-top:4px; margin-top:-2px; }
        #messages li.grouped .message-header { display:none; }
        .message-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:4px; }
        .message-sender { font-weight:700; font-size:.8rem; text-transform:uppercase; letter-spacing:0.3px; }
        .message-timestamp { font-size:.7rem; color:var(--text-muted); margin-left:10px; }
        .other-message { background:rgba(255,255,255,0.08); color:var(--text); align-self:flex-start; border-bottom-left-radius:6px; border:1px solid rgba(255,255,255,0.08); }
        .other-message .message-sender { color:var(--accent); }
        .other-message .message-timestamp { opacity:.6; }
        .my-message { background:rgba(0,255,65,0.12); color:var(--msg-mine-text); align-self:flex-end; border-bottom-right-radius:6px; border:1px solid rgba(0,255,65,0.2); }
        .my-message .message-sender { color:var(--accent); opacity:.9; }
        .my-message .message-timestamp { color:var(--text-muted); opacity:.6; }
        #messages img { max-width:100%; border-radius:12px; cursor:zoom-in; margin-top:8px; border:1px solid var(--border); }
        .system-message { color:var(--text-muted); font-size:.8rem; font-weight:500; text-align:center; align-self:center; padding:8px 0; width:100%; background:none!important; max-width:100%!important; text-transform:uppercase; letter-spacing:0.5px; }

        /* Reply quote */
        .reply-quote { font-size:.8rem; padding:8px 12px; margin-bottom:8px; border-left:3px solid var(--accent); background:rgba(0,255,65,0.08); border-radius:0 8px 8px 0; color:var(--text-muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:320px; }

        /* Reactions */
        .reactions-row { display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
        .reaction-chip { display:inline-flex; align-items:center; gap:4px; padding:4px 10px; background:rgba(0,255,65,0.08); border:1px solid rgba(0,255,65,0.15); border-radius:20px; font-size:.8rem; cursor:pointer; transition:all .15s; }
        .reaction-chip:hover { background:rgba(0,255,65,0.15); border-color:rgba(0,255,65,0.3); }
        .reaction-chip .r-count { font-size:.75rem; color:var(--text-muted); font-weight:600; }

        /* Message actions (reply + react) */
        .msg-actions { position:absolute; top:-8px; right:8px; display:none; gap:3px; z-index:10; }
        .my-message .msg-actions { right:auto; left:8px; }
        #messages li:hover .msg-actions { display:flex; }
        .msg-action-btn { width:28px; height:28px; border-radius:8px; border:1px solid var(--border-strong); background:var(--surface-raised); display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all .15s; }
        .msg-action-btn:hover { background:var(--accent-subtle); border-color:var(--accent); }
        .msg-action-btn svg { width:14px; height:14px; stroke:var(--text-secondary); fill:none; transition:stroke .15s; }
        .msg-action-btn:hover svg { stroke:var(--accent); }

        /* Reaction picker */
        .reaction-picker { position:absolute; bottom:calc(100% + 8px); right:0; display:flex; gap:6px; padding:8px 12px; background:var(--surface-raised); border:1px solid var(--border-strong); border-radius:12px; box-shadow:0 12px 32px rgba(0,0,0,.4); z-index:20; }
        .reaction-picker span { font-size:1.2rem; cursor:pointer; padding:4px 6px; border-radius:8px; transition:all .15s; }
        .reaction-picker span:hover { background:var(--accent-subtle); transform:scale(1.15); }

        /* Ephemeral message */
        .ephemeral-msg { opacity:.9; }
        .ephemeral-bar { height:2px; background:var(--red); border-radius:1px; margin-top:8px; transition:width linear; }
        .ephemeral-label { font-size:.7rem; color:var(--red); margin-top:4px; display:flex; align-items:center; gap:4px; font-weight:600; text-transform:uppercase; letter-spacing:0.3px; }
        .ephemeral-shake { animation:bombShake .15s ease; }
        @keyframes bombShake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-3px)} 50%{transform:translateX(3px)} 75%{transform:translateX(-2px)} }

        /* Link preview */
        .link-preview { display:block; margin-top:10px; padding:10px 12px; background:rgba(0,255,65,0.08); border:1px solid rgba(0,255,65,0.15); border-radius:10px; text-decoration:none; color:var(--text); transition:all .2s; }
        .link-preview:hover { background:rgba(0,255,65,0.12); border-color:rgba(0,255,65,0.25); }
        .link-preview .lp-domain { font-size:.75rem; color:var(--text-muted); margin-bottom:4px; text-transform:uppercase; letter-spacing:0.3px; font-weight:600; }
        .link-preview .lp-title { font-size:.85rem; font-weight:600; color:var(--accent); }

        /* Typing indicator */
        #typing-indicator { padding:8px 20px 8px; font-size:.8rem; color:var(--text-muted); min-height:28px; flex-shrink:0; display:flex; align-items:center; gap:6px; font-weight:500; text-transform:uppercase; letter-spacing:0.3px; }

        /* Chat Footer Stats */
        #chat-footer { padding:16px 20px; border-top:1px solid var(--border); background:rgba(0,0,0,0.2); text-align:center; font-size:.8rem; font-weight:500; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.3px; line-height:1.6; }
        #chat-footer span { color:var(--accent); font-weight:700; }
        #chat-footer .footer-divider { margin:8px 0; height:1px; background:rgba(255,255,255,0.08); }
        #chat-footer .footer-copyright { font-size:.7rem; color:var(--text-secondary); text-transform:none; letter-spacing:0; margin-top:8px; }
        .typing-dots { display:inline-flex; gap:4px; }
        .typing-dots span { width:6px; height:6px; border-radius:50%; background:var(--accent); animation:typingBounce 1.4s infinite; }
        .typing-dots span:nth-child(2) { animation-delay:.2s; }
        .typing-dots span:nth-child(3) { animation-delay:.4s; }
        @keyframes typingBounce { 0%,60%,100%{transform:translateY(0)} 30%{transform:translateY(-4px)} }

        /* Reply bar above input */
        #reply-bar { display:none; padding:10px 16px; border-top:1px solid var(--border); background:rgba(0,255,65,0.08); flex-shrink:0; align-items:center; gap:10px; font-size:.8rem; color:var(--text-secondary); font-weight:500; }
        #reply-bar.active { display:flex; }
        #reply-bar .reply-text { flex-grow:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        #reply-bar .reply-close { cursor:pointer; color:var(--text-muted); font-size:18px; padding:0 6px; transition:all .2s; }
        #reply-bar .reply-close:hover { color:var(--accent); transform:scale(1.2); }

        /* Input area */
        #form { display:flex; padding:14px 16px; border-top:1px solid var(--border); align-items:center; gap:10px; flex-shrink:0; background:rgba(0,0,0,0.2); }
        #input { border:1px solid var(--border); background:rgba(255,255,255,0.06); color:var(--text); padding:11px 16px; flex-grow:1; border-radius:12px; font-size:.95rem; font-family:'Space Grotesk',sans-serif; font-weight:400; outline:none; transition:all .2s; }
        #input::placeholder { color:var(--text-muted); }
        #input:focus { border-color:var(--accent); background:rgba(255,255,255,0.08); box-shadow:0 0 0 2px rgba(0,255,65,0.1); }
        #form button { background:var(--accent); border:none; width:40px; height:40px; border-radius:12px; cursor:pointer; display:flex; justify-content:center; align-items:center; padding:0; flex-shrink:0; transition:all .2s; }
        #form button:hover { opacity:.9; transform:scale(1.05); }
        #form button svg { width:18px; height:18px; }
        #form #submit-btn svg { fill:var(--bg); margin-left:1px; }
        #form #attach-btn { background:transparent; border:1px solid var(--border); }
        #form #attach-btn svg { stroke:var(--text-muted); fill:none; stroke-width:2; transition:stroke .2s; }
        #form #attach-btn:hover { border-color:var(--accent); background:var(--accent-subtle); }
        #form #attach-btn:hover svg { stroke:var(--accent); }

        /* Ephemeral toggle */
        #ephemeral-btn { background:transparent; border:1px solid var(--border); position:relative; transition:all .2s; }
        #ephemeral-btn svg { stroke:var(--text-muted); fill:none; transition:stroke .2s; }
        #ephemeral-btn:hover { border-color:var(--red); background:rgba(255,68,68,0.08); }
        #ephemeral-btn.active { border-color:var(--red); background:rgba(255,68,68,0.15); }
        #ephemeral-btn.active svg { stroke:var(--red); }

        /* Scroll to bottom */
        #scroll-bottom-btn { position:absolute; bottom:20px; right:24px; width:40px; height:40px; border-radius:50%; background:var(--accent); border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow:0 8px 24px rgba(0,255,65,0.2); opacity:0; pointer-events:none; transition:all .3s; transform:translateY(10px); z-index:10; }
        #scroll-bottom-btn.visible { opacity:1; pointer-events:auto; transform:translateY(0); }
        #scroll-bottom-btn:hover { transform:translateY(-2px); box-shadow:0 12px 32px rgba(0,255,65,0.3); }
        #scroll-bottom-btn svg { width:18px; height:18px; stroke:var(--bg); fill:none; stroke-width:2.5; }

        /* Copy bubble */
        #copy-bubble { position:fixed; bottom:30px; left:50%; transform:translate(-50%,60px); background:var(--accent); color:var(--bg); padding:12px 24px; border-radius:12px; z-index:1000; opacity:0; font-size:.85rem; font-weight:600; transition:transform .4s,opacity .4s; pointer-events:none; text-transform:uppercase; letter-spacing:0.5px; }
        #copy-bubble.show { transform:translate(-50%,0); opacity:1; }

        /* Generic modal overlay */
        .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.7); backdrop-filter:blur(6px); display:flex; justify-content:center; align-items:center; z-index:3000; opacity:1; transition:opacity .3s; }
        .modal-overlay.hidden { opacity:0; pointer-events:none; }
        .modal-box { background:var(--surface); border:1px solid var(--border); width:90%; max-width:560px; max-height:85vh; padding:2.2rem 2.6rem; border-radius:18px; overflow-y:auto; position:relative; scrollbar-width:thin; scrollbar-color:var(--border-strong) transparent; box-shadow:0 20px 60px rgba(0,0,0,0.3); }
        .modal-close { position:absolute; top:16px; right:20px; font-size:24px; font-weight:400; color:var(--text-muted); cursor:pointer; transition:all .2s; line-height:1; }
        .modal-close:hover { color:var(--accent); transform:scale(1.2); }
        .modal-box h3 { margin-top:0; font-size:1.25rem; font-weight:700; margin-bottom:.5rem; color:var(--text-primary); }

        /* FAQ */
        .faq-subtitle { font-size:.85rem; font-weight:400; color:var(--text-secondary); line-height:1.6; margin-bottom:1.5rem; padding-bottom:1.2rem; border-bottom:1px solid var(--border); }
        .faq-item { margin-bottom:0; padding:1.2rem 0; border-bottom:1px solid var(--border); }
        .faq-item:last-child { border-bottom:none; }
        .faq-item-header { display:flex; align-items:center; gap:12px; margin-bottom:10px; }
        .faq-icon { width:36px; height:36px; border-radius:10px; background:var(--accent-subtle); border:1px solid rgba(0,255,65,0.2); display:flex; align-items:center; justify-content:center; flex-shrink:0; }
        .faq-icon svg { stroke:var(--accent); }
        .modal-box h4 { font-size:.95rem; font-weight:700; margin:0; color:var(--text-primary); }
        .faq-answer { font-size:.85rem; font-weight:400; line-height:1.7; color:var(--text-secondary); margin:0 0 0 48px; }
        .faq-expand-btn { display:inline-flex; align-items:center; gap:4px; margin:10px 0 0 48px; padding:6px 12px; background:var(--accent-subtle); border:1px solid rgba(0,255,65,0.2); border-radius:8px; color:var(--text-muted); font-size:.75rem; font-family:inherit; font-weight:600; cursor:pointer; transition:all .2s; text-transform:uppercase; letter-spacing:0.3px; }
        .faq-expand-btn:hover { color:var(--accent); border-color:var(--accent); background:rgba(0,255,65,0.15); }
        .faq-expand-btn svg { transition:transform .25s; }
        .faq-item.expanded .faq-expand-btn svg { transform:rotate(180deg); }
        .faq-item.expanded .faq-expand-btn { color:var(--accent); }
        .faq-technical { max-height:0; overflow:hidden; transition:max-height .35s,opacity .3s; opacity:0; margin-left:48px; }
        .faq-item.expanded .faq-technical { max-height:300px; opacity:1; }
        .faq-technical p { font-size:.8rem; font-weight:400; line-height:1.7; color:var(--text-secondary); margin:10px 0 0 0; padding:12px 14px; background:rgba(0,255,65,0.06); border:1px solid rgba(0,255,65,0.15); border-radius:10px; }
        .faq-technical p strong { color:var(--accent); font-weight:600; }

        /* FAQ button row */
        .faq-btn-row { display:flex; gap:8px; margin:10px 0 0 48px; flex-wrap:wrap; }
        .faq-btn-row .faq-expand-btn, .faq-btn-row .faq-eli5-btn { margin:0; }

        /* ELI5 button */
        .faq-eli5-btn { display:inline-flex; align-items:center; gap:4px; padding:6px 12px; background:rgba(251,191,36,0.08); border:1px solid rgba(251,191,36,0.2); border-radius:8px; color:var(--text-muted); font-size:.75rem; font-family:inherit; font-weight:600; cursor:pointer; transition:all .2s; text-transform:uppercase; letter-spacing:0.3px; }
        .faq-eli5-btn:hover { color:#fbbf24; border-color:rgba(251,191,36,0.4); background:rgba(251,191,36,0.12); }
        .faq-item.eli5-open .faq-eli5-btn { color:#fbbf24; border-color:rgba(251,191,36,0.4); background:rgba(251,191,36,0.12); }

        /* ELI5 collapsible block */
        .faq-eli5 { max-height:0; overflow:hidden; transition:max-height .35s,opacity .3s; opacity:0; margin-left:48px; }
        .faq-item.eli5-open .faq-eli5 { max-height:300px; opacity:1; }
        .faq-eli5 p { font-size:.85rem; font-weight:400; line-height:1.7; color:#fbbf24; margin:10px 0 0 0; padding:12px 14px; background:rgba(251,191,36,0.06); border:1px solid rgba(251,191,36,0.15); border-radius:10px; }

        /* Password modal */
        .modal-input { width:100%; padding:11px 16px; border:1px solid var(--border); background:rgba(255,255,255,0.06); color:var(--text); border-radius:10px; font-family:'Space Grotesk',sans-serif; font-size:.95rem; outline:none; margin:14px 0; transition:all .2s; }
        .modal-input:focus { border-color:var(--accent); background:rgba(255,255,255,0.08); box-shadow:0 0 0 2px rgba(0,255,65,0.1); }
        .modal-btn { display:inline-flex; align-items:center; justify-content:center; padding:11px 28px; background:var(--accent); color:var(--bg); border:none; border-radius:10px; font-family:'Space Grotesk',sans-serif; font-size:.9rem; font-weight:700; cursor:pointer; transition:all .2s; text-transform:uppercase; letter-spacing:0.5px; }
        .modal-btn:hover { opacity:.9; transform:scale(1.02); }
        .modal-error { color:var(--red); font-size:.8rem; margin-top:10px; display:none; font-weight:600; text-transform:uppercase; letter-spacing:0.3px; }

        /* Security verification */
        .security-code { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin:18px 0; }
        .security-code span { padding:14px; background:rgba(0,255,65,0.08); border:1px solid rgba(0,255,65,0.2); border-radius:10px; text-align:center; font-family:'Space Mono',monospace; font-size:1.05rem; font-weight:700; color:var(--accent); letter-spacing:2px; }

        /* QR Modal */
        #qr-canvas { display:block; margin:16px auto; border-radius:8px; background:#fff; padding:12px; }

        /* Room timer */
        #room-timer { display:none; align-items:center; gap:6px; font-size:.8rem; font-weight:600; color:var(--text-muted); padding:6px 12px; background:rgba(0,255,65,0.08); border:1px solid rgba(0,255,65,0.2); border-radius:10px; text-transform:uppercase; letter-spacing:0.3px; }
        #room-timer svg { width:14px; height:14px; stroke:currentColor; fill:none; }
        #room-timer.active { display:flex; color:var(--accent); }
        #room-timer.urgent { color:var(--red); border-color:rgba(255,68,68,0.3); background:rgba(255,68,68,0.08); }
        #room-timer.urgent svg { stroke:var(--red); }

        /* Image modal */
        .image-modal { display:none; position:fixed; z-index:4000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,.9); backdrop-filter:blur(8px); justify-content:center; align-items:center; }
        .modal-image-content { max-width:90%; max-height:85vh; object-fit:contain; border-radius:12px; animation:zoomIn .3s ease; border:1px solid var(--border); }
        @keyframes zoomIn { from{opacity:0;transform:scale(.92)} to{opacity:1;transform:scale(1)} }
        .close-modal { position:absolute; top:24px; right:32px; color:rgba(0,255,65,.5); font-size:32px; cursor:pointer; transition:all .2s; line-height:1; }
        .close-modal:hover { color:var(--accent); transform:scale(1.2); }

        /* Responsive */
        @media(max-width:1023px) { #main-layout { flex-direction:column; max-height:100vh; height:100%; padding:0; } #app-container { border-radius:0; border:none; } #banner { height:100px; } }
        @media(max-width:600px) { #messages li { max-width:88%; } #form { padding:10px 12px; } .header-group { gap:4px; } #e2e-badge span { display:none; } }
    </style>
</head>
<body>
    <canvas id="matrix-canvas"></canvas>
    <div id="main-layout">
        <div id="app-container">
            <div id="banner"></div>
            <div id="header">
                <div class="header-group">
                    <div id="online-users-wrapper">
                        <button id="online-users-btn" type="button">
                            <span class="online-dot"></span>
                            <span class="online-count" id="user-count-number">0</span>
                            <span class="online-label">online</span>
                            <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                        </button>
                        <div id="online-users-dropdown">
                            <div class="dropdown-header"><span>Online</span><span class="count-badge" id="dropdown-count">0</span></div>
                            <ul id="online-users-list"></ul>
                        </div>
                    </div>
                    <div id="e2e-badge" title="End-to-End Encrypted">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        <span>E2E</span>
                    </div>
                    <div id="my-username-wrapper" title="Clique para editar seu nome">
                        <span id="my-username-text">...</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                        <input id="my-username-input" type="text" maxlength="30" placeholder="Seu nome..."/>
                    </div>
                    <div id="room-timer">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        <span id="timer-text">--:--</span>
                    </div>
                    <button id="invite-btn" class="icon-btn" title="Convidar">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                    </button>
                </div>
                <div class="header-group">
                    <button id="sound-btn" class="icon-btn toggle-btn" title="Som">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                    </button>
                    <button id="notif-btn" class="icon-btn toggle-btn" title="Notifica√ß√µes">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                    </button>
                    <button id="security-btn" class="icon-btn" title="Verificar seguran√ßa">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    </button>
                    <button id="faq-btn" class="icon-btn" title="FAQ">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                    </button>
                    <button id="new-room-btn" class="icon-btn" title="Criar Outra Sala">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
                    </button>
                    <div id="theme-switcher">
                        <div class="theme-icons">
                            <span class="theme-icon active" id="sun-icon">‚òÄÔ∏è</span>
                            <span class="theme-icon" id="moon-icon">üåô</span>
                        </div>
                        <div class="toggle-switch" id="theme-toggle">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="chat-container">
                <ul id="messages"></ul>
                <button id="scroll-bottom-btn" type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                <div id="typing-indicator"></div>
                <div id="reply-bar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 17 4 12 9 7"/><path d="M20 18v-2a4 4 0 0 0-4-4H4"/></svg>
                    <span class="reply-text" id="reply-text"></span>
                    <span class="reply-close" id="reply-close">&times;</span>
                </div>
                <form id="form" action="" autocomplete="off">
                    <button type="button" id="attach-btn" title="Anexar imagem">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
                    </button>
                    <button type="button" id="ephemeral-btn" title="Mensagem tempor√°ria">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    </button>
                    <input type="file" id="image-input" accept="image/*" style="display:none"/>
                    <input id="input" name="chat-message" autocomplete="off" placeholder="Aguardando conex√£o segura..." disabled/>
                    <button type="submit" id="submit-btn" title="Enviar"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
                </form>
                <div id="chat-footer">
                    <div><span id="chat-rooms-count">340282366920938463463374607431768211456</span> salas √∫nicas dispon√≠veis</div>
                    <div class="footer-divider"></div>
                    <div class="footer-copyright">¬© CONFESSORIUM 2026 - A privacidade n√£o √© uma op√ß√£o, √© um direito.</div>
                </div>
            </div>
        </div>
    </div>

    <div id="copy-bubble"></div>

    <!-- Password Modal -->
    <div id="password-modal" class="modal-overlay hidden">
        <div class="modal-box" style="max-width:380px; text-align:center;">
            <h3>Sala protegida</h3>
            <p style="font-size:.85rem; color:var(--text-secondary); margin-top:4px;">Esta sala requer uma senha para entrar.</p>
            <input type="password" id="password-input" class="modal-input" placeholder="Digite a senha..."/>
            <button id="password-submit" class="modal-btn" style="width:100%;">Entrar</button>
            <p class="modal-error" id="password-error">Senha incorreta. Tente novamente.</p>
        </div>
    </div>

    <!-- FAQ Modal -->
    <div id="faq-modal" class="modal-overlay hidden"><div id="faq-container" class="modal-box"></div></div>

    <!-- Security Verification Modal -->
    <div id="security-modal" class="modal-overlay hidden">
        <div class="modal-box" style="max-width:400px; text-align:center;">
            <span class="modal-close" id="security-close">&times;</span>
            <h3>Verifica√ß√£o de seguran√ßa</h3>
            <p style="font-size:.82rem; color:var(--text-secondary); margin-top:4px; line-height:1.6;">Compare este c√≥digo com os outros participantes da sala. Se for igual, a conex√£o √© segura.</p>
            <div class="security-code" id="security-code"></div>
            <p style="font-size:.72rem; color:var(--text-muted);">Derivado da chave AES-256 da sala via SHA-256</p>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qr-modal" class="modal-overlay hidden">
        <div class="modal-box" style="max-width:360px; text-align:center;">
            <span class="modal-close" id="qr-close">&times;</span>
            <h3>Convidar por QR Code</h3>
            <p style="font-size:.82rem; color:var(--text-secondary); margin-top:4px;">Escaneie com a c√¢mera para entrar na sala.</p>
            <canvas id="qr-canvas" width="200" height="200"></canvas>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="image-modal" class="image-modal">
        <span class="close-modal">&times;</span>
        <img class="modal-image-content" id="modal-image-content"/>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="client.js"></script>

    <script>
    (() => {
        // Matrix background effect
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        const body = document.body;

        // Set canvas size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Matrix effect
        const chars = '01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥';
        const charArray = chars.split('');
        const fontSize = 16;
        const columns = () => Math.floor(canvas.width / fontSize);
        let drops = Array(Math.floor(columns())).fill(0);

        // Update drops array on resize
        window.addEventListener('resize', () => {
            drops = Array(Math.floor(columns())).fill(0);
        });

        function drawMatrix() {
            // Clear with transparency
            ctx.fillStyle = body.classList.contains('light-theme')
                ? 'rgba(245, 245, 245, 0.05)'
                : 'rgba(10, 10, 10, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Set character color based on theme
            ctx.fillStyle = body.classList.contains('light-theme')
                ? 'rgba(0, 200, 50, 0.4)'
                : 'rgba(0, 255, 65, 0.3)';
            ctx.font = `${fontSize}px 'Space Mono', monospace`;
            ctx.textAlign = 'center';

            for (let i = 0; i < drops.length; i++) {
                const text = charArray[Math.floor(Math.random() * charArray.length)];
                ctx.fillText(text, i * fontSize + fontSize / 2, drops[i] * fontSize);

                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        function animate() {
            drawMatrix();
            requestAnimationFrame(animate);
        }
        animate();
    })();
    </script>
</body>
</html>
